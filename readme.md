# Jarndyce – Web Server & Blogging Engine

## Introduction
Jarndyce is a light-weight web server for sites with static pages (about, contact, etc.) and a blog. It uses HTML and a standard JSON metadata header for every page that can be used as input to the Jade templates. This makes customization easy!

## Installation

Make sure you have Node and NPM installed (http://nodejs.org)

Clone this repository into ./jarndyce:

`git clone https://github.com/jordanschalm/jarndyce.git jarndyce`

Resolve dependencies with npm:

`cd jarndyce`

`npm install`

Run vanilla Jarndyce:

`node jarndyce`

## Usage
To customize your site’s appearance:
* add a site.css file in /static/resources/
* alter the provided blog.jade and static.jade templates
If you are using RSS, change the RSS settings portion of the package.json file

To add static pages, simply place the HTML file in the /static/ directory and add a link to it somewhere in the Jade templates to make it easily accessible.

To add a blog post, simply place the blog post HTML file in the /blog/ directory and jarndyce will automatically add it to the /blog page of your website.

Once everything looks good, it is easy to deploy to Heroku using this [tutorial](https://devcenter.heroku.com/articles/deploying-nodejs “Heroku Node.js tutorial”).

## Static Pages
Static pages are kept in the static folder. These pages are served using the app.get(‘/:slug‘) routing method. During initialization, HTML files found *non-recursively* in the /static/ directory will be cached as static pages. These files should contain *at least* title metadata as this is used by the static.jade template file to generate standard titles. Standard headers are generated by the Jade template so HTML files in the ./static folder should only contain page content (whatever is below the header) and metadata. There are a couple sample static pages included as examples.

## Blog Pages
The standard home page is the most recent blog page. Blog pages are collections of blog posts arranged by date from most to least recent. The number of blog posts per page can be changed using the POSTS_PER_PAGE symbolic constant (the default is 5). Blog posts can also be accessed individually at www.yourdomain.com/blog/title. Since blog posts are accessed individually by title, if two posts are uploaded with exactly the same title, only one will be individually accessible (they will still both be accessible through page navigation).

Blog post files must be placed in the /blog/ directory. During initialization, Jarndyce will search this folder recursively for files matching *.html and add each one as a post object in memory with references to:

* Title
* Date
* HTML content
* Path on disk
* URL
* Any other metadata specified in the header

When a blog page or blog post is requested, Jarndyce looks up the necessary post(s) and renders them with a Jade template which can be found at /templates/blog.jade. This template uses the title and date metadata to create a standardized title/date header above each post, so don’t include title or date headers after the metadata section of your blog post file!

Blog bodies must be in HTML format and must have at least the following header metadata: title, date. Data metadata must be parseable be Date.parse() in order for blogs to be correctly ordered.

### Syntax Highlighting
The blog.jade template includes the necessary code to perform client-side syntax highlighting in code blocks using [Highlight.js](https://highlightjs.org “Highlight.js”). A link to the default highlighting stylesheet is included in the head.

### Images
Blog post files can be placed anywhere within the /blog/ directory and so can image files, so long as they have the proper image suffix (that is how the Express routing rules decide to treat them differently).

If you want to, you can have all of blog post HTML files and all of your blog post image files in the same directory, but it’s probably a good idea to keep all the files associated with each blog post in its own sub-directory of /blog/.

## Metadata
Metadata sections are in a subset of the JSON format and must be at the beginning of the file. Metadata sections do not support nested {…} sections for simplicity, but do support array values. Metadata keys are not case-sensitive and any keys are converted to lowercase. An example metadata section looks like the following:

{ “Title” : “An Investigation Into The Life Of Basket Weavers”, “date” : “June 2, 2015”, “catEGOries” : [“Basket Weaving”, “Investigative Journalism”] }

This translates to:

`post.title = “An Investigation Into The Life Of Basket Weavers”;`

`post.date = “June 2, 2015”;`

`post.categories = [“Basket Weaving”, “Investigative Journalism”];`

## Templating
Jarndyce uses [Jade](http://jade-lang.com “Jade”) for templating. Two very basic sample templates are included, one for blogs and one for static pages.

## Plans For Future Versions
Jarndyce is currently functional but feature-poor. Some features I plan to add include:
* A standard stylesheet for distributions of Jarndyce that includes a footer and looks acceptable
* Support for some sort of post categorization system, category links below each post, and viewing lists of posts by category.

## Known Issues
Currently Jarndyce will cache ALL detected blog posts and ALL detected static pages no matter how many there are. For a site with a large archive, this could lead to Jarndyce crashing during initialization.

## Change Log

### 1.0.1 
Bug Fixes - June 3, 2015

* Made filesystem operations after initialisation thread-friendly
* Added licence header to jarndyce.js
* Added ability to specify port as a commandline argument (node jarndyce <port>)
* Fixed an issue where serveBlogImage would cause a request to hang when a filesystem error occurred
* Added support for an optional blog metadata item, timeStamp, which is used for finer-grain chronological sorting whereas the data item is used as a nicely formatted date string
* Fixed a bug that would generate bad URLs in Older/Newer blog page navigation
* Changed blog URLs so that spaces are left in instead of beign converted to '-'s. This fixes a bug where blog titles with '-'s had broken URLs.# with '#' will be ignored, and an empty message aborts the commit.

### 1.0.0
Initial Release - June 2, 2015

Features:
* RSS support
* support for caching blog/static HTML content & metadata on launch
